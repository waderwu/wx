# 图书漂流活动（数据库大作业）
## 预实现功能
### 后台实现的功能
- 在后台添加书籍
- 后台添加借阅关系
- 后台添加用户信息
- 后台可以看到一些统计数据
- 读者搜索书籍是否可以借阅
- 读者预约书籍
- 借书后发封邮件给读者，提醒到期日期
- 快到归还期限的时候，发邮件提醒读者
- 当预约的书到了的时候，发邮件通知读者来领
- 添加一本书的isbn，自动爬取豆瓣的信息，然后自动创建，描述，相关书籍推荐，subjectID等属性
### 前端展示
- 搜索框，搜索书名显示哪些书被借，哪些书在架上，被借的书什么时候归还
- 根据搜索的书，和爬取的豆瓣相关推荐书籍，然后与本地数据库相比较，然后在把有的相关书籍推荐，显示出来
- 首页显示在架的书籍，和豆瓣链接，也会显示全部的书籍，供学生浏览

# 数据库设计

user 一张表 主要用来记录用户信息
包括的属性有：
姓名，学号，班级，邮箱，密码，userid(wechat对应的），wechat ，电话号码

book 一张表
包括的属性有：
书名，isbn，douban, state,

borrowBook 关于借阅关系的表
包括的属性有：
所借的书，所对应的用户，借阅日期，实际归还日期

orderBook 关于预约的一张表
包括的属性有：
所预约的书，所对应的用户，预约时间，是否已经借了书

# 已经完成的情景
## 情景1：
买来了一批书，管理员只需要输入书后面的isbn ，即可完成书籍的输入。其他的信息通过爬取豆瓣的信息，然后存在douban这张表中，通过isbn来链接。
管理员同时在书上标注好id，以区分相同的书籍

## 情景2：
xiaoz 同学，注册了一个帐号（如果没注册帐号，管理员会让他们注册） ，在网站上搜索发现自己想看的《白夜行》还在架上，然后去3-102,去借。管理员在后台新建立一个借阅关系。
同时自动发邮件通知xiaoz，他借了这本书，应该在什么时候还。同时也自动，将书的state更改为已外借。

## 情景3 ：
xiaom 同学，也想看《白夜行》 ，他在网上搜索后发现，《白夜行》这本书被借走过了，于是在注册登录后，他预约了这本书。
后台生成一条预约关系

## 情景4 ：
快到还书时间了，系统自动发了一封邮件催xiaoz 抓紧看，看完了赶紧还回来

## 情景5 ：
xiaoz 看完了《白夜行》 然后到3-102去还书，这是管理员，更改actualBackDate，确认还书。
这时，系统自动发送邮件通知xiaoz，已经成功还书，同时通知xiaom，书籍已经还了，过来去。
系统做的另外一件事情就是，更改《白夜行》的state为预约中，更改预约关系中的state为 已通知

## 情景6：
xiaom 收到邮件后来取书，管理员新建立一条借阅关系。
同时邮件通知xiaom借书成功，应还日期，借阅关系中的state 更改为已经取书

## 情景7：
过了，shouldBackDate ，但是xiaoz 没有归还《白夜行》，这是管理员，找到xiaoz 的电话号码，电话催

## 情景8：
xiaom ， 收到预约的书已经到了的邮件但是没能来取。
管理员新建一条小m的借阅关系，然后开始再填上actualBackDate （即帮xiaom ，在2分钟之内借了然后还回来）

## 情景9：
xiaot ， 想找本书看，但是不知道啥好看，他来到了网站的首页，看到了哪些书在架上（及书的豆瓣评分，介绍，相关推荐的书），哪些书被借出去了。
选择了一本《偷影子的人》作为课外读物。

# 遇到的问题及其解决方法
http://stackoverflow.com/questions/1355150/django-when-saving-how-can-you-check-if-a-field-has-changed

http://stackoverflow.com/questions/573618/django-set-up-a-scheduled-job

